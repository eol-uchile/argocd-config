apiVersion: apps/v1
kind: Deployment
metadata:
  name: otrs-deploy
  labels:
    service: otrs-deploy
  annotations:
    reloader.stakater.com/auto: "true"
spec:
  replicas: 1
  selector:
    matchLabels:
      service: otrs-deploy
  template:
    metadata:
      labels:
        service: otrs-deploy
    spec:
      containers:
      - name: otrs
        image: eoluchile/eol-otrs:4bb25b8dd1633cb2bf52eb63a2c8abc11b1de512
        env:
        - name: OTRS_BACKUP_TIME
          value: disabled
        - name: OTRS_HOSTNAME
          value: eol-ayuda.uchile.cl
        - name: OTRS_HTTP_TYPE
          value: https
        - name: OTRS_TIMEZONE
          value: UTC
        - name: SHOW_OTRS_LOGO
          value: no
        - name: OTRS_DEFAULT_EMAIL
          value: no-reply@eol.uchile.cl
        - name: OTRS_DB_HOST
          valueFrom:
            secretKeyRef:
              name: otrs
              key: OTRS_DB_HOST
        - name: OTRS_DB_PORT
          valueFrom:
            secretKeyRef:
              name: otrs
              key: OTRS_DB_PORT
        - name: OTRS_DB_NAME
          valueFrom:
            secretKeyRef:
              name: otrs
              key: OTRS_DB_NAME
        - name: OTRS_DB_USER
          valueFrom:
            secretKeyRef:
              name: otrs
              key: OTRS_DB_USER
        - name: OTRS_DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: otrs
              key: OTRS_DB_PASSWORD
        - name: OTRS_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: otrs
              key: OTRS_ROOT_PASSWORD
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: 1500Mi
            cpu: 250m
          limits:
            memory: 2000Mi
            cpu: 500m
---
apiVersion: v1
kind: Service
metadata:
  name: otrs
spec:
  selector:
    service: otrs-deploy
  ports:
  - name: "80"
    port: 80
    targetPort: 80
